# Column Names Fix - Summary

## Issue
The Add/Edit Customer forms were showing wrong field names because:
1. The config file had outdated column names
2. The actual Google Sheets had different column names
3. HTML entities like `&amp;` were not being decoded

## Solution Applied

### 1. Updated Backend Config
**File:** `server/src/config/insuranceClients.js`

Updated Joban's column mappings to match actual Google Sheets:

#### **General Insurance (30 columns):**
```
S NO, NAME, POLICY NO, G CODE, LAST YEAR PREMIUM, DATE OF EXPIRY, 
MODIFIED EXPIRY DATE, COMPANY, TYPE, DEPOSITED/ PAYMENT DATE, 
CHQ NO & DATE, BANK NAME, CUSTOMER ID, AGENT CODE, AMOUNT, 
NEW POLICY NO, NEW POLICY COMPANY, Product Type, Product Model, 
VEH NO, TP Expiry Date, Premium mode, EMAIL ID, MOBILE NO, 
STATUS, Thankyou message sent yes/no, REMARKS, PANCARD, 
AADHAR CARD, OTHERS - VI/DL/PP
```

#### **Life Insurance (27 columns):**
```
STATUS, THANKYOU MESSAGE SENT, PAYMENT DATE, DATE OF EXPIRY, 
POLICY NO, NAME, EMAIL ID, MOBILE NO, PREMIUM, INSURER, 
AG, POL, PT, PPT, MD, BR, SUMM, PAYMENT TYPE, PHONE CALL, 
SORT, COM, I MAGIC, TRUE, _PREVSTATUS, _PREVRANK, 
_FAMEARLIEST, REMARKS, FC
```

### 2. Updated Frontend Forms
**File:** `client/src/pages/InsuranceDashboard.tsx`

**Changes:**
- Added filter to skip "S NO" field (auto-generated serial number)
- Fixed HTML entity decoding: `&amp;` → `&`
- Applied to both Add and Edit Customer modals

**Code:**
```typescript
.filter(field => !['S NO', 's no', 'S_NO'].includes(field))
.map((field) => {
  const key = field.toLowerCase().replace(/\s+/g, '_').replace(/&amp;/g, '&');
  // ... rest of the logic
})
```

## How It Works Now

1. **Dynamic Field Loading:**
   - System fetches actual column headers from Google Sheets
   - Uses `getSheetHeaders()` service to read first row
   - Different columns for each client and vertical

2. **Smart Field Detection:**
   - Date fields → Date picker
   - Email fields → Email input
   - Premium/Amount → Number input
   - Status → Dropdown (DUE/Renewed/Not Renewed/In Process)
   - Notes/Remarks → Textarea
   - Others → Text input

3. **Auto-Skip Fields:**
   - "S NO" is automatically skipped (serial number)
   - Can add more fields to skip if needed

## Testing

### For Joban General Insurance:
- [ ] All 29 fields show (excluding S NO)
- [ ] G CODE field is visible
- [ ] CHQ NO & DATE shows correctly (not CHQ NO &amp; DATE)
- [ ] All date fields have date pickers
- [ ] AMOUNT field is number input
- [ ] STATUS is dropdown

### For Joban Life Insurance:
- [ ] All 27 fields show
- [ ] Special fields like AG, POL, PT, PPT, MD, BR, SUMM visible
- [ ] _PREVSTATUS, _PREVRANK, _FAMEARLIEST visible
- [ ] PREMIUM is number input
- [ ] STATUS is dropdown

## Files Modified

1. **server/src/config/insuranceClients.js**
   - Updated Joban general insurance schema (30 fields)
   - Updated Joban life insurance schema (27 fields)

2. **client/src/pages/InsuranceDashboard.tsx**
   - Added S NO filter in Add Customer modal
   - Added S NO filter in Edit Customer modal
   - Added HTML entity decoding

## Benefits

✅ Forms now show **exact** column names from Google Sheets
✅ No hardcoding - automatically adapts to sheet changes
✅ Different fields for different clients (KMG vs Joban)
✅ Different fields for different verticals (General vs Life)
✅ Proper field type detection
✅ Clean field names (no HTML entities)

## Notes

- The system reads headers from row 1 of the Google Sheet
- Column order in form matches sheet column order
- If you add/remove columns in the sheet, forms update automatically
- No code changes needed when sheet structure changes
- S NO is skipped because it's auto-generated by sheets
